<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Transpondeur</title>
  <style>
    body {
      background-color: #2e3b4e;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
    }
    .transponder {
      background-color: #3c4b5a;
      padding: 40px;
      border-radius: 20px;
      display: flex;
      gap: 30px;
      align-items: center;
    }
    .display {
      background-color: black;
      color: #ff6b00;
      font-family: 'DS-Digital', sans-serif;
      font-size: 48px;
      width: 140px;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 4px solid #888;
      border-radius: 6px;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 10px;
    }
    .keypad button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #1f1f1f;
      color: white;
      font-size: 22px;
      border: none;
      cursor: pointer;
    }
    .keypad button:hover {
      background-color: #333;
    }
    .ident-button {
      border: 2px solid white;
    }
    .label-ident {
      font-size: 12px;
      margin-top: -5px;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, set, onDisconnect, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBPq6Wfxzq02MfK69BFxHm9_FUjDGTmAcw",
      authDomain: "kykychat-24c7f.firebaseapp.com",
      databaseURL: "https://kykychat-24c7f-default-rtdb.firebaseio.com",
      projectId: "kykychat-24c7f",
      storageBucket: "kykychat-24c7f.firebasestorage.app",
      messagingSenderId: "342562811927",
      appId: "1:342562811927:web:0fed1e1f511c4fddcfec52"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let currentSquawk = "----";
    let callsign = prompt("Entrez votre callsign:");
    let positionEnabled = false;
    let position = {};

    function updateDisplay() {
      document.getElementById("squawkDisplay").innerText = currentSquawk;
    }

    function saveData() {
      if (currentSquawk !== "0000") {
        set(ref(db, "transponder/" + callsign), {
          squawk: currentSquawk,
          position: position
        });
      }
    }

    function requestLocation() {
      navigator.geolocation.getCurrentPosition(pos => {
        position = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };
        positionEnabled = true;
        saveData();
      });
    }

    requestLocation();

    window.addEventListener("load", () => {
      const buttons = document.querySelectorAll(".keypad button");
      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          if (btn.id === "clr") {
            currentSquawk = "----";
          } else if (btn.id === "ident") {
            if (currentSquawk.length === 4) saveData();
          } else {
            if (currentSquawk.includes("-")) {
              currentSquawk = currentSquawk.replace("-", btn.innerText);
            }
          }
          updateDisplay();
        });
      });
    });
  </script>
</head>
<body>
  <div class="transponder">
    <div class="keypad">
      <button>1</button>
      <button>2</button>
      <button>3</button>
      <button>4</button>
      <button>5</button>
      <button>6</button>
      <button>7</button>
      <button>0</button>
      <button>8</button>
      <button>9</button>
      <button id="clr">CLR</button>
      <div>
        <button id="ident" class="ident-button">‚óè</button>
        <div class="label-ident">IDENT</div>
      </div>
    </div>
    <div class="display" id="squawkDisplay">----</div>
  </div>
</body>
</html>
